<div class="w-full lg:mx-auto lg:w-1/3 lg:mt-10" fxLayout="row">
  <h2>Buy Tokens</h2>
  <mat-card class="mb-3">
    <div class="text-center w-auto flex flex-nowrap">
      <p class="text-gray-400">Your Balance</p>
      <div class="flex flex-col w-1/4 right-0 mx-auto">
        <p class="w-1/3 text-right whitespace-nowrap">{{ uupxAmount | microNumber }} UPX</p>
        <p class="w-1/3 text-right whitespace-nowrap">{{ uspxAmount | microNumber }} SPX</p>
      </div>
    </div>
  </mat-card>
  <!-- <form (submit)="onSubmit(accountID || '', priceRef.value, amountRef.value, denomRef.value)"></form> -->
  <mat-card class="mb-5">
    <mat-list class="my-5">
      <p class="text-gray-400">Token Select</p>
      <mat-button-toggle-group #denomRef class="w-full" #group="matButtonToggleGroup">
        <mat-button-toggle #denomRef value="UPX" class="w-1/2 text-2xl" [value]="tokens[0].value"> UPX </mat-button-toggle>
        <mat-button-toggle #denomRef value="SPX" class="w-1/2 text-2xl" [value]="tokens[1].value"> SPX </mat-button-toggle>
      </mat-button-toggle-group>
    </mat-list>
    <mat-divider [inset]="true"></mat-divider>

    <mat-list class="mb-5">
      <div class="text-gray-400 mb-3">1{{ group.value }} =</div>
      <div class="flex place-content-center">
        <div class="text-center w-auto flex flex-nowrap">
          <mat-form-field class="break-all w-1/2 m-auto">
            <mat-label>Input JPY</mat-label>
            <input class="h-7" #priceRef matInput type="number" step="0.1" [(ngModel)]="price" name="price" required />
          </mat-form-field>

          <div class="mt-5 text-2xl">JPY</div>
        </div>
      </div>
      <mat-accordion>
        <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
          <mat-expansion-panel-header class="h-5 bg-gray-400" [collapsedHeight]="'20px'" [expandedHeight]="'20px'">
            <mat-panel-title class="justify-center"> More Info </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="my-3 text-lg">Latest Contract Price</div>
          <div class="mb-3">
            <mat-card class="mb-2" style="background-color: #6c8fb6; color: white">
              <div>UPX</div>
              <div class="text-center">
                <div>
                  Latest UPX Price: &nbsp;&nbsp;<span class="text-lg">{{ singlePriceNormal?.price_ujpy | microString }}</span> JPY
                </div>
                <div>
                  Contract Amount:&nbsp;&nbsp;&nbsp;<span class="text-lg"> {{ singlePriceNormal?.amount_uupx | microString }}</span> UPX
                </div>
                <div>
                  Market Date:&nbsp;&nbsp; <span class="text-lg">{{ singlePriceNormalDate | date: 'yy/MM/dd' }}</span>
                </div>
              </div>
            </mat-card>
            <mat-card class="mb-2" style="background-color: #b67cb6; color: white">
              <div>SPX</div>
              <div class="text-center">
                <div>
                  Latest SPX Price:&nbsp;&nbsp; <span class="text-lg">{{ singlePriceRenewable?.price_ujpy | microString }}</span> JPY
                </div>
                <div>
                  Contract Amount:&nbsp;&nbsp;&nbsp;&nbsp;<span class="text-lg">{{ singlePriceRenewable?.amount_uspx | microString }}</span>
                  SPX
                </div>
                <div>
                  Market Date:&nbsp;&nbsp; <span class="text-lg">{{ singlePriceRenewableDate | date: 'yy/MM/dd' }}</span>
                </div>
              </div>
            </mat-card>
          </div>

          <mat-divider [inset]="true"></mat-divider>

          <ng-container *ngIf="normalGraphAmounts == null || normalGraphPrices == null; then loading; else loadedNormal"></ng-container>
          <ng-template #loading>
            <mat-progress-spinner [diameter]="60" [mode]="'indeterminate'"></mat-progress-spinner>
          </ng-template>
          <ng-template #loadedNormal>
            <div class="my-3 text-lg">Yesterday's Order</div>
            <mat-list>
              <mat-list-item>
                <span>UPX</span>
              </mat-list-item>
              <ng-container *ngIf="isNormalContractToday; then existNormalContract; else noContract"></ng-container>
              <ng-template #existNormalContract>
                <mat-list-item>
                  <mat-list-item class="flex flex-wrap">
                    <span class="break-all" style="font-size: medium">Contract Price:</span>
                    <span class="flex-auto break-all"></span>
                    <span class="break-all">{{ singlePriceNormal?.price_ujpy | microString }}</span>
                    <span class="break-all" style="margin-left: 10px">JPY</span>
                  </mat-list-item>
                </mat-list-item>
              </ng-template>
              <ng-template #noContract>
                <mat-list-item>
                  <span class="break-all" style="color: #ff0000">No Contract</span>
                </mat-list-item>
              </ng-template>
            </mat-list>
            <canvas
              baseChart
              [datasets]="normalGraphAmounts!"
              [labels]="normalGraphPrices!"
              [options]="barChartOptions"
              [plugins]="barChartPlugins"
              [legend]="barChartLegend"
              [chartType]="barChartType"
              [colors]="barColors"
            >
            </canvas>
          </ng-template>
          <ng-container
            *ngIf="renewableGraphAmounts == null || renewableGraphPrices == null; then loading; else loadedRenewable"
          ></ng-container>
          <ng-template #loadedRenewable>
            <mat-list>
              <mat-list-item>
                <span>SPX</span>
              </mat-list-item>
              <ng-container *ngIf="isRenewableContractToday; then existRenewableContract; else noContract"></ng-container>
              <ng-template #existRenewableContract>
                <mat-list-item>
                  <mat-list-item class="flex flex-wrap">
                    <span class="break-all">Contract Price:</span>
                    <span class="flex-auto break-all"></span>
                    <span class="break-all">{{ singlePriceRenewable?.price_ujpy | microString }}</span>
                    <span class="break-all" style="margin-left: 10px">JPY</span>
                  </mat-list-item>
                </mat-list-item>
              </ng-template>
              <ng-template #noContract>
                <mat-list-item>
                  <span class="break-all" style="color: #ff0000">No Contract</span>
                </mat-list-item>
              </ng-template>
            </mat-list>
            <canvas
              baseChart
              [datasets]="renewableGraphAmounts!"
              [labels]="renewableGraphPrices!"
              [options]="barChartOptions"
              [plugins]="barChartPlugins"
              [legend]="barChartLegend"
              [chartType]="barChartType"
              [colors]="barColors"
            >
            </canvas>
          </ng-template>
        </mat-expansion-panel>
      </mat-accordion>
    </mat-list>
    <mat-divider [inset]="true"></mat-divider>
    <mat-list class="mb-3">
      <div class="text-center w-auto flex flex-nowrap">
        <p class="text-gray-400 w-1/3 text-right align-bottom">Token Amount</p>
        <mat-form-field class="break-all w-1/4 right-0 mx-auto">
          <mat-label>Input Amount</mat-label>
          <input class="h-7" #amountRef matInput type="number" step="0.1" [(ngModel)]="amount" name="amount" required />
        </mat-form-field>
      </div>
      <div class="text-center w-auto flex flex-nowrap">
        <p class="text-gray-400 w-1/3 text-right">Total Price</p>
        <span class="whitespace-nowrap w-1/4 right-0 mx-auto"
          ><span class="text-lg">{{ calcTotalPrice(price, amount) }}</span> JPY</span
        >
      </div>
      <div class="text-center w-auto flex flex-nowrap">
        <p class="text-gray-400 w-1/3 text-right">Total Energy</p>
        <span class="whitespace-nowrap break-all w-1/4 right-0 mx-auto">
          <span class="text-lg">{{ amount }}</span> kWh</span
        >
      </div>
    </mat-list>
    <div class="mb-10">
      <button mat-stroked-button class="w-full text-lg bg-green-600 text-white">Bid Request</button>
    </div>
  </mat-card>

  <!-- <mat-card class="mb-10">
    <mat-card-title>Available Balance</mat-card-title>
    <details>
      <summary>Read More</summary>
      <mat-card-content>
        <p>Displays the currently available UPX and SPX balances.</p>
        <p>Refer to this Available Balance when creating an ask request.</p>
      </mat-card-content>
    </details>
    <mat-list>
      <mat-list-item class="flex flex-wrap" style="padding: auto; margin-bottom: 4px; border: 2.5px solid #6c8fb6; border-radius: 10px">
        <span class="break-all text-xl" style="color: #6c8fb6">UPX:</span>
        <span class="flex-auto break-all"></span>
        <span class="break-all text-xl" style="font-size: x-large">{{ uupxAmount | microNumber }}</span>
      </mat-list-item>
      <mat-list-item class="flex flex-wrap" style="padding: auto; margin-bottom: 4px; border: 2.5px solid #b67cb6; border-radius: 10px">
        <span class="break-all text-xl" style="color: #b67cb6">SPX:</span>
        <span class="flex-auto break-all"></span>
        <span class="break-all text-xl" style="font-size: x-large">{{ uspxAmount | microNumber }}</span>
      </mat-list-item>
      <ng-container *ngIf="insufficiencyAmount">
        <mat-list-item class="flex flex-wrap" style="padding: auto">
          <span class="break-all text-xl">Insufficient Balance:</span>
          <span class="flex-auto break-all"></span>
          <span class="break-all text-xl" style="font-size: x-large">{{ insufficiencyAmount | microNumber }}</span>
        </mat-list-item>
      </ng-container>
      <mat-divider [inset]="true"></mat-divider>
    </mat-list>
  </mat-card>

  <mat-card class="mb-10">
    <mat-card-title>Latest Contract Price</mat-card-title>
    <details>
      <summary>Read More</summary>
      <mat-card-content>
        <p>Displays the latest contracted price.</p>
        <p>If there were no contract, the last transaction price with constraints will be displayed here.</p>
      </mat-card-content>
    </details>
    <mat-list>
      <mat-card class="flex flex-wrap" style="padding: 0px; margin-bottom: 10px; border: 2.5px solid #6c8fb6; border-radius: 10px">
        <mat-list-item>
          <span class="break-all text-xl" style="color: #6c8fb6">UPX</span>
        </mat-list-item>
        <mat-list-item class="flex flex-wrap">
          <span class="break-all text-xl" style="font-size: medium">Latest UPX Price:</span>
          <span class="flex-auto break-all"></span>
          <span class="break-all text-xl" style="font-size: x-large">{{ singlePriceNormal?.price_ujpy | microString }}</span>
          <span class="break-all text-xl" style="margin-left: 10px; font-size: small">JPY</span>
        </mat-list-item>
        <mat-divider [inset]="true"></mat-divider>
        <mat-list-item class="flex flex-wrap">
          <span class="break-all text-xl" style="font-size: medium">Contract Amount:</span>
          <span class="flex-auto break-all"></span>
          <span class="break-all text-xl" style="font-size: x-large">{{ singlePriceNormal?.amount_uupx | microString }}</span>
          <span class="break-all text-xl" style="margin-left: 10px; font-size: small">UPX</span>
        </mat-list-item>
        <mat-divider [inset]="true"></mat-divider>
        <mat-list-item class="flex flex-wrap">
          <span class="break-all text-xl" style="font-size: medium">Market Date:</span>
          <span class="flex-auto break-all"></span>
          <span class="break-all text-xl" style="font-size: x-large">{{ singlePriceNormalDate | date: 'yy/MM/dd' }}</span>
        </mat-list-item>
      </mat-card>
      <mat-card class="flex flex-wrap" style="padding: 0px; border: 2.5px solid #b67cb6; border-radius: 10px">
        <mat-list-item>
          <span class="break-all text-xl" style="color: #b67cb6">SPX</span>
        </mat-list-item>
        <mat-list-item class="flex flex-wrap">
          <span class="break-all text-xl" style="font-size: medium">Latest SPX Price:</span>
          <span class="flex-auto break-all"></span>
          <span class="break-all text-xl" style="font-size: x-large">{{ singlePriceRenewable?.price_ujpy | microString }}</span>
          <span class="break-all text-xl" style="margin-left: 10px; font-size: small">JPY</span>
        </mat-list-item>
        <mat-divider [inset]="true"></mat-divider>
        <mat-list-item class="flex flex-wrap">
          <span class="break-all text-xl" style="font-size: medium">Contract Amount:</span>
          <span class="flex-auto break-all"></span>
          <span class="break-all text-xl" style="font-size: x-large">{{ singlePriceRenewable?.amount_uspx | microString }}</span>
          <span class="break-all text-xl" style="margin-left: 10px; font-size: small">SPX</span>
        </mat-list-item>
        <mat-divider [inset]="true"></mat-divider>
        <mat-list-item class="flex flex-wrap">
          <span class="break-all text-xl" style="font-size: medium">Market Date:</span>
          <span class="flex-auto break-all"></span>
          <span class="break-all text-xl" style="font-size: x-large">{{ singlePriceRenewableDate | date: 'yy/MM/dd' }}</span>
        </mat-list-item>
      </mat-card>
    </mat-list>
  </mat-card>

  <mat-card class="mb-10">
    <mat-card-title>Yesterday's Orders</mat-card-title>
    <details>
      <summary>Read More</summary>
      <mat-card-content>
        <p>Displays the yesterday's order status.</p>
        <p>Bids is shown as negative values and Asks as positive values.</p>
      </mat-card-content>
    </details>
    <ng-container *ngIf="normalGraphAmounts == null || normalGraphPrices == null; then loading; else loadedNormal"></ng-container>
    <ng-template #loading>
      <mat-progress-spinner [diameter]="60" [mode]="'indeterminate'"></mat-progress-spinner>
    </ng-template>
    <ng-template #loadedNormal>
      <mat-card class="flex flex-wrap" style="padding: 0px; margin-bottom: 10px; border: 2.5px solid #6c8fb6; border-radius: 10px">
        <mat-list>
          <mat-list-item>
            <span class="break-all text-xl" style="color: #6c8fb6">UPX</span>
          </mat-list-item>
          <ng-container *ngIf="isNormalContractToday; then existNormalContract; else noContract"></ng-container>
          <ng-template #existNormalContract>
            <mat-list-item>
              <mat-list-item class="flex flex-wrap">
                <span class="break-all text-xl" style="font-size: medium">Contract Price:</span>
                <span class="flex-auto break-all"></span>
                <span class="break-all text-xl" style="font-size: x-large">{{ singlePriceNormal?.price_ujpy | microString }}</span>
                <span class="break-all text-xl" style="margin-left: 10px; font-size: small">JPY</span>
              </mat-list-item>
            </mat-list-item>
          </ng-template>
          <ng-template #noContract>
            <mat-list-item>
              <span class="break-all text-xl" style="color: #ff0000">No Contract</span>
            </mat-list-item>
          </ng-template>
        </mat-list>
        <canvas
          baseChart
          [datasets]="normalGraphAmounts!"
          [labels]="normalGraphPrices!"
          [options]="barChartOptions"
          [plugins]="barChartPlugins"
          [legend]="barChartLegend"
          [chartType]="barChartType"
          [colors]="barColors"
        >
        </canvas>
      </mat-card>
    </ng-template>
    <ng-container *ngIf="renewableGraphAmounts == null || renewableGraphPrices == null; then loading; else loadedRenewable"></ng-container>
    <ng-template #loadedRenewable>
      <mat-card class="flex flex-wrap" style="padding: 0px; border: 2.5px solid #b67cb6; border-radius: 10px">
        <mat-list>
          <mat-list-item>
            <span class="break-all text-xl" style="color: #b67cb6">SPX</span>
          </mat-list-item>
          <ng-container *ngIf="isRenewableContractToday; then existRenewableContract; else noContract"></ng-container>
          <ng-template #existRenewableContract>
            <mat-list-item>
              <mat-list-item class="flex flex-wrap">
                <span class="break-all text-xl" style="font-size: medium">Contract Price:</span>
                <span class="flex-auto break-all"></span>
                <span class="break-all text-xl" style="font-size: x-large">{{ singlePriceRenewable?.price_ujpy | microString }}</span>
                <span class="break-all text-xl" style="margin-left: 10px; font-size: small">JPY</span>
              </mat-list-item>
            </mat-list-item>
          </ng-template>
          <ng-template #noContract>
            <mat-list-item>
              <span class="break-all text-xl" style="color: #ff0000">No Contract</span>
            </mat-list-item>
          </ng-template>
        </mat-list>
        <canvas
          baseChart
          [datasets]="renewableGraphAmounts!"
          [labels]="renewableGraphPrices!"
          [options]="barChartOptions"
          [plugins]="barChartPlugins"
          [legend]="barChartLegend"
          [chartType]="barChartType"
          [colors]="barColors"
        >
        </canvas>
      </mat-card>
    </ng-template>
  </mat-card>

  <form (submit)="onSubmit(accountID || '', priceRef.value, amountRef.value, denomRef.value)">
    <mat-card class="mb-10">
      <mat-card-title>Token Market - Buy (Next Auction 9:00 a.m.)</mat-card-title>
      <details>
        <summary>Read More</summary>
        <mat-card-content>
          <p>Create a Bid request for the day's single-price auction.</p>
          <p>
            At 9:00 (JST) every day, the market will set the intersection of the sell curve and the buy curve as the contract price and
            contract quantity.
          </p>
        </mat-card-content>
      </details>
      <mat-card-content class="mt-5">
        <p style="color: #ff0000">The base price has been changed to <b>&yen;21.5/kWh</b>.</p>
        <p style="color: #ff0000">The SPX base price has been changed to <b>&yen;22.0/kWh</b> since Sep. Please note.</p>
        <p>You cannot order between 9:00-11:00 (JST).</p>
      </mat-card-content>
      <mat-list>
        <h3 matSubheader>Token Price</h3>
        <mat-list-item class="flex flex-wrap">
          <span class="flex-auto w-1/10 break-all text-center">1</span>
          <mat-form-field class="flex-auto w-1/5 break-all">
            <mat-label>Token</mat-label>
            <mat-select #denomRef>
              <mat-option *ngFor="let token of tokens" [value]="token.value">
                {{ token.viewValue }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <span class="flex-auto w-1/10 break-all"></span>
          <mat-icon color="accent" class="flex-auto w-1/5 break-all text-center"> drag_handle</mat-icon>
          <span class="flex-auto w-1/10 break-all"></span>
          <mat-form-field class="flex-auto w-1/5 break-all">
            <mat-label>Input JPY</mat-label>
            <input #priceRef matInput type="number" [(ngModel)]="price" name="price" required />
          </mat-form-field>
          <span class="flex-auto w-1/10 break-all text-center">JPY</span>
        </mat-list-item>
        <mat-divider [inset]="true"></mat-divider>

        <h3 matSubheader>Amount & Price</h3>
        <mat-list-item class="flex flex-wrap">
          <span class="break-all">Token Amount:</span>
          <span class="flex-auto break-all"></span>
          <mat-form-field class="break-all">
            <mat-label>Input Amount</mat-label>
            <input #amountRef matInput type="number" [(ngModel)]="amount" name="amount" required />
          </mat-form-field>
        </mat-list-item>
        <mat-divider [inset]="true"></mat-divider>

        <mat-list-item class="flex flex-wrap">
          <span class="break-all">Total Price:</span>
          <span class="flex-auto break-all"></span>
          <span class="break-all">{{ calcTotalPrice(price, amount) }} JPY</span>
        </mat-list-item>
        <mat-divider [inset]="true"></mat-divider>

        <mat-list-item class="flex flex-wrap">
          <span class="break-all">Total Energy:</span>
          <span class="flex-auto break-all"></span>
          <span class="break-all">{{ amount }} kWh</span>
        </mat-list-item>
        <mat-divider [inset]="true"></mat-divider>
      </mat-list>
      <div class="mt-10">
        <button mat-flat-button class="w-full" color="accent">Buy Request</button>
      </div>
    </mat-card>
  </form>
</div> -->
</div>
